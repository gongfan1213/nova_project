# 移除本地持久化功能更新

## 更新原因
由于用户背景数据已经通过数据库进行同步，无需额外的本地持久化功能。为了简化系统架构和避免数据不一致的问题，移除了 Zustand persist 中间件。

## 具体变更

### 1. 移除依赖
```typescript
// 移除
import { persist } from 'zustand/middleware'
```

### 2. 简化 Store 创建
```typescript
// 之前
export const useBgData = create<BgDataState>()(
  persist(
    (set, _get) => ({ ... }),
    { 
      name: 'bg-data-storage',
      partialize: (state) => ({ ... })
    }
  )
)

// 现在
export const useBgData = create<BgDataState>()((set, _get) => ({
  // ... store 逻辑
}))
```

### 3. 状态行为变化
- **当前选择状态**: 仅在内存中保存，页面刷新后重置
- **数据列表**: 通过 `refreshUserBackground()` 从数据库加载
- **操作状态**: 增删改操作直接同步到数据库

## 优势

### 1. 架构简化
- 减少了本地存储的复杂性
- 避免本地缓存与数据库数据不一致的问题
- 降低了数据同步的复杂度

### 2. 数据一致性
- 始终以数据库为单一数据源
- 避免本地缓存过期的问题
- 确保多设备间数据同步

### 3. 性能优化
- 减少了序列化/反序列化开销
- 简化了状态更新逻辑
- 更快的应用启动速度

## 用户体验影响

### 保持不变的功能
- ✅ 所有 CRUD 操作正常工作
- ✅ 当前选择功能在会话内正常工作
- ✅ 实时状态更新和视觉反馈
- ✅ 数据库同步和权限控制

### 行为变化
- 🔄 页面刷新后当前选择状态会重置
- 🔄 首次加载时需要重新选择当前配置
- 🔄 会话间不保持选择状态

## 最佳实践建议

### 1. 数据加载
```typescript
// 组件挂载时主动刷新数据
useEffect(() => {
  refreshUserBackground()
}, [])
```

### 2. 选择管理
- 在每个会话开始时重新选择需要的配置
- 利用下拉菜单快速查看和选择配置
- 通过创建有意义的名称便于快速识别

### 3. 工作流程优化
- 为常用配置创建容易识别的名称
- 按使用频率组织配置顺序
- 利用编辑功能优化配置描述

## 技术细节

### 状态管理
- 使用纯 Zustand store，无中间件
- 状态仅存在于 JavaScript 内存中
- 组件卸载时状态自动清理

### 数据流
```
用户操作 → API 调用 → 数据库更新 → 本地状态更新 → UI 重新渲染
```

### 错误处理
- API 调用失败时显示错误提示
- 网络异常时不影响已加载的数据
- 乐观更新确保流畅的用户体验

## 总结

移除本地持久化后，系统变得更加简洁和可靠。虽然页面刷新后需要重新选择配置，但这确保了数据的一致性和系统的简洁性。对于需要跨会话保持配置的需求，可以考虑在后端实现"用户偏好设置"功能。 