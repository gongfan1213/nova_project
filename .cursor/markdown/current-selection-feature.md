# 当前选择功能实现文档

## 功能概述
为用户背景数据管理系统添加当前选择功能，允许用户选择并记住当前使用的人设、意图、资源和账号风格。

## 实现内容

### 1. useBgData Hook 扩展

#### 新增状态字段
```typescript
// 当前选择的项目
currentPersonality: BgDataItem | null
currentIntention: BgDataItem | null
currentResource: BgDataItem | null
currentAccountStyle: BgDataItem | null
```

#### 新增方法
```typescript
// 设置当前选择项
setCurrentItem: (type: BgDataType, item: BgDataItem | null) => void

// 获取当前选择项
getCurrentItem: (type: BgDataType) => BgDataItem | null
```

#### 数据管理
- 当前选择项存储在内存中，随页面刷新重置
- 数据本身通过数据库同步，无需本地持久化

#### 删除时自动清理
- 当删除一个项目时，如果该项目是当前选择项，会自动清除选择状态
- 确保不会出现选择了已删除项目的情况

### 2. 用户界面更新

#### 下拉菜单按钮
- **未选择状态**: 显示 "选择{类型}" (如 "选择人设")
- **已选择状态**: 显示当前选择项的名称
- 文本过长时自动截断显示

#### 下拉菜单内容
- **添加新项**: 蓝色按钮，位于顶部
- **清除选择**: 仅在有选择时显示，灰色按钮
- **项目列表**: 显示所有可选项目

#### 选择状态视觉反馈
- **当前选择项**: 
  - 蓝色背景 (`bg-blue-50`)
  - 左侧蓝色边框 (`border-l-4 border-blue-500`)
  - 蓝色文字 (`text-blue-700`)
  - 右侧显示选中标记 (✓)

#### 交互行为
- 点击项目名称区域即可选择
- 点击后自动关闭下拉菜单
- 悬停时仍显示编辑/删除按钮

### 3. 功能特点

#### 独立选择状态
- 每种类型(人设/意图/资源/账号风格)都有独立的当前选择
- 可以同时选择不同类型的多个项目

#### 状态同步
- 选择状态实时更新到界面
- 内存状态管理，无本地持久化
- 删除项目时自动维护状态一致性

#### 用户体验优化
- 清晰的视觉反馈
- 直观的操作流程
- 防误操作设计

## 使用方式

### 选择项目
1. 点击卡片下方的下拉按钮
2. 在展开的列表中点击想要选择的项目
3. 下拉菜单自动关闭，按钮显示选择的项目名称

### 清除选择
1. 点击下拉按钮展开菜单
2. 点击"清除选择"按钮
3. 恢复到未选择状态

### 编辑/删除
- 在下拉菜单中悬停项目，右侧显示编辑和删除按钮
- 编辑和删除功能与之前保持一致
- 删除当前选择项时会自动清除选择状态

## 技术实现细节

### 状态管理
```typescript
// 设置当前选择
setCurrentItem('personalities', selectedPersonality)

// 获取当前选择
const current = getCurrentItem('personalities')

// 清除选择
setCurrentItem('personalities', null)
```

### 组件集成
```typescript
<Dropdown
  type={card.type}
  items={items}
  currentItem={getCurrentItem(card.type)}
  onSelect={(item) => setCurrentItem(card.type, item)}
  // ... 其他 props
/>
```

### 数据同步
- 使用 Zustand 进行状态管理
- 内存状态，页面刷新后重置
- 与数据库数据保持同步更新

## 应用场景

### 1. AI 配置快速切换
- 用户可以预设多套人设配置
- 快速切换不同场景下的 AI 行为
- 提升工作效率

### 2. 模板管理
- 保存常用的配置组合
- 新项目可基于现有配置快速开始
- 减少重复配置工作

### 3. 会话内状态管理
- 在当前会话中记住选择的配置
- 快速切换不同配置组合
- 提升操作效率

## 扩展可能

### 1. 配置组合保存
- 将四种类型的当前选择作为一个配置组合保存
- 支持多套配置组合的快速切换

### 2. 默认配置
- 支持设置默认配置
- 新建项目时自动应用默认配置

### 3. 配置分享
- 支持导出当前配置
- 与其他用户分享配置方案

## 总结

当前选择功能为用户背景数据管理系统增加了重要的状态管理能力，使系统从单纯的数据管理工具升级为具备配置记忆功能的智能工具。通过直观的视觉反馈和简单的操作流程，用户可以轻松管理和切换不同的配置组合，大大提升了系统的实用性和用户体验。 